<!DOCTYPE html>
<!-- saved from url=(0036)http://localhost:5173/p5-runner.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>p5.js Runner</title>
  <script src="./p5.min.js.下载" defer=""></script>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body data-new-gr-c-s-check-loaded="14.1116.0" data-gr-ext-installed="">
  <script>
    let currentP5Instance = null;
    let currentScriptTag = null;

    window.addEventListener('message', event => {
      if (!event.data || event.data.type !== 'P5_CODE') {
        return;
      }

      const { code } = event.data;

      if (currentP5Instance) currentP5Instance.remove();
      if (currentScriptTag) currentScriptTag.remove();

      if (!code) return;

      try {
        currentScriptTag = document.createElement('script');
        currentScriptTag.innerHTML = code;
        document.body.appendChild(currentScriptTag);
        currentP5Instance = new p5();
      } catch (err) {
        document.body.innerHTML = `<div style="font-family: monospace; color: red; padding: 20px; white-space: pre-wrap;">${err}</div>`;
      }
    });
  </script>


<script>let walkers = [];
let angle = 0;
let r = 100;
let hue = 0;
let stars = [];
let snowflakes = [];

function setup() {
  createCanvas(635, 720);
  for (let i = 0; i < 50; i++) {
    walkers.push(new Walker(random(width), random(height)));
  }
  for (let i = 0; i < 200; i++) {
    stars.push(new Star(random(width), random(height), random(1, 3)));
  }
  background(20);
  colorMode(HSB);
  strokeWeight(2);
  fill(255);
  noStroke();
}

function draw() {
  background(20, 20, 20, 25);
  let speed = map(mouseX, 0, width, 0.01, 0.1);
  let ratio = map(mouseY, 0, height, 0.1, 1);
  let x = r * cos(angle) + (r * ratio) * cos(angle * 6);
  let y = r * sin(angle) + (r * ratio) * sin(angle * 6);
  translate(width / 2, height / 2);
  stroke(hue, 100, 100, 0.8);
  point(x, y);
  angle += speed;
  hue += 0.5;
  if (hue > 360) hue = 0;

  walkers.forEach(walker => {
    walker.follow(x, y);
    walker.render();
  });
  
  stars.forEach(star => {
    star.render();
  });

  for (let i = 0; i < random(5); i++) {
    snowflakes.push(new Snowflake());
  }

  snowflakes.forEach(flake => {
    flake.update(frameCount / 60);
    flake.display();
  });

  frameRate(30);
}

class Walker {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  render() {
    stroke(255, 100);
    strokeWeight(2);
    point(this.x, this.y);
  }

  follow(targetX, targetY) {
    let choice = floor(random(4));
    if (choice === 0) {
      this.x += (targetX - this.x) * 0.05;
    } else if (choice === 1) {
      this.x -= (targetX - this.x) * 0.05;
    } else if (choice === 2) {
      this.y += (targetY - this.y) * 0.05;
    } else {
      this.y -= (targetY - this.y) * 0.05;
    }
    this.x = constrain(this.x, 0, width - 1);
    this.y = constrain(this.y, 0, height - 1);
  }
}

class Star {
  constructor(x, y, size) {
    this.x = x;
    this.y = y;
    this.size = size;
    this.hue = random(360);
  }

  render() {
    stroke(this.hue, 100, 100);
    strokeWeight(this.size);
    point(this.x, this.y);
  }
}

class Snowflake {
  constructor() {
    this.posX = 0;
    this.posY = random(-50, 0);
    this.initialangle = random(0, 2 * PI);
    this.size = random(2, 5);
    this.radius = sqrt(random(pow(width / 2, 2)));
  }

  update(time) {
    let w = 0.6;
    let angle = w * time + this.initialangle;
    this.posX = width / 2 + this.radius * sin(angle);
    this.posY += pow(this.size, 0.5);

    if (this.posY > height) {
      let index = snowflakes.indexOf(this);
      snowflakes.splice(index, 1);
    }
  }

  display() {
    ellipse(this.posX, this.posY, this.size);
  }
}

function mousePressed() {
  background(20);
}
</script><main><canvas id="defaultCanvas0" class="p5Canvas" width="635" height="720" style="width: 635px; height: 720px;"></canvas></main></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>